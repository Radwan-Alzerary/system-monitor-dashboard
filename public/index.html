<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>System Monitor Dashboard</title>
  <!-- Tailwind CSS via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100">
  <div class="container mx-auto p-4">
    <h1 class="text-3xl font-bold text-center mb-6">System Monitor Dashboard</h1>
    
    <!-- CPU Usage Card -->
    <div id="cpu" class="bg-white p-4 rounded shadow mb-4">
      <h2 class="text-2xl font-semibold mb-2">CPU Usage</h2>
      <p class="text-lg" id="cpu-load">Loading...</p>
    </div>
    
    <!-- Memory Usage Card -->
    <div id="memory" class="bg-white p-4 rounded shadow mb-4">
      <h2 class="text-2xl font-semibold mb-2">Memory Usage</h2>
      <p class="text-lg" id="memory-info">Loading...</p>
    </div>
    
    <!-- Disk Usage Card -->
    <div id="disk" class="bg-white p-4 rounded shadow mb-4">
      <h2 class="text-2xl font-semibold mb-2">Disk Usage</h2>
      <div id="disk-info">Loading...</div>
    </div>
    
    <!-- PM2 Logs Card -->
    <div id="logs" class="bg-white p-4 rounded shadow">
      <h2 class="text-2xl font-semibold mb-2">PM2 Logs</h2>
      <div id="pm2-logs" class="bg-gray-900 text-green-300 p-2 rounded overflow-y-scroll h-64 font-mono text-xs">
        Loading logs...
      </div>
    </div>
  </div>
  
  <script>
    // Connect using the native WebSocket API
    const socket = new WebSocket(`ws://${window.location.host}`);
    
    // Listen for messages from the server
    socket.addEventListener('message', (event) => {
      try {
        const msg = JSON.parse(event.data);
        if (msg.type === 'systemData') {
          const data = msg.payload;
          // Update CPU usage display
          document.getElementById('cpu-load').innerText = data.cpu.load + '%';
    
          // Update memory usage display
          document.getElementById('memory-info').innerText =
            `Total: ${data.memory.total} MB, Used: ${data.memory.used} MB, Free: ${data.memory.free} MB`;
    
          // Update disk usage display
          let diskHtml = '';
          data.disk.forEach((d) => {
            diskHtml += `
              <div class="mb-2 border-b pb-2">
                <p class="font-bold">Filesystem: ${d.fs}</p>
                <p>Size: ${d.size} GB</p>
                <p>Used: ${d.used} GB</p>
                <p>Usage: ${d.use}%</p>
              </div>
            `;
          });
          document.getElementById('disk-info').innerHTML = diskHtml;
        }
        else if (msg.type === 'pm2Logs') {
          const logContainer = document.getElementById('pm2-logs');
          // Append the new log data, converting newline characters to <br>
          logContainer.innerHTML += msg.payload.replace(/\n/g, '<br/>');
          logContainer.scrollTop = logContainer.scrollHeight;
        }
      } catch (error) {
        console.error('Error parsing message:', error);
      }
    });
  </script>
</body>
</html>
